<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Solicitar Servicio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#09CACD">
  <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.1.3/webcomponents-loader.js">
  </script>
  <script defer src="/__/firebase/5.5.4/firebase-app.js"></script>
  <script defer src="/__/firebase/5.5.4/firebase-auth.js"></script>
  <script defer src="/__/firebase/5.5.4/firebase-database.js"></script>
  <script defer src="/__/firebase/init.js"></script>
  <script type="module" src="js/herramientas-detalle.js"></script>
  <script type="module" src="js/campos-usuario.js"></script>
  <link rel="stylesheet" href="css/misestilos2.css">
</head>

<body>
  <form class="vista" name="vista" action="javascript:;">
    <herramientas-detalle id="cabecera" titulo="Solicitar Servicio" regreso="index.html" agrega></herramientas-detalle>
    <main role="main" class="blanc">
      <p>
        <label accesskey="U">
          Direccion
          <input name="dire" type="text" autofocus>
        </label>
      </p>
      <p>
        <label>
          Hora
          <input type="time" name="hora" required="">
        </label>
      </p>
      <p>
        <label>
          Fecha
          <input type="date" name="fechaDeInicio" required="">
        </label>
      </p>
      
      <p>
        <label>
          Nombre del Trabajador
          <select name="nom" ></select>
          </label>
      </p>
        <p>
          <label accesskey="R">
            Tipo
            <select id="cate" name="cate[]" ></select>
          </label>
        </p>
         <select hidden name="Rol" >
          <option selected value="Proceso">Proceso</option>
        </select>
    </main>
  </form>
  <script type="module">
    import { Util } from "./js/util.js";
    import { Dao } from "./js/dao.js";
      import { Navegacion } from "./js/navegacion.js";
   Util.registraServiceWorker();
    const locationRegreso = "index.html";
    let roles;
    document.addEventListener('DOMContentLoaded', () => {
      Navegacion.sesionInicia();
      if (WebComponents.ready) {
        carga();
      } else {
        document.addEventListener('WebComponentsReady', carga);
      }
    });
    function carga() {
      roles = document.getElementById("cate");
      document.vista.addEventListener("submit", guarda);

      Dao.consulta("Trabajador", "nom",
        rol => ({ texto1: rol.nom }))
        .then(filas =>
          Util.agregaOpciones(document.vista.nom, {}, filas))
        .catch(Util.muestraError);


      Dao.consulta("Servicio", "cate",
        rol => ({ texto1: rol.cate + ": " + rol.deta }))
        .then(filas => Util.agregaOpciones(roles, {}, filas))
        .catch(Util.muestraError);

    }
    function guarda() {
      try {
        const dire = document.vista.dire.value.trim();
        const hora = document.vista.hora.value.trim();
        const fechaDeInicio = document.vista.fechaDeInicio.value.trim();
        const nom = document.vista.nom.value.trim();
        const cate = document.vista.cate.value.trim();
        const modelo = {
          dire: dire,
          nom: nom,
          fechaDeInicio: fechaDeInicio,
          cate: cate,
          hora: hora,
          Status: Util.getValores(document.vista.Rol)
        };
              Dao.agrega("SolicitudServicio", modelo)
            
          .then(() => window.location = locationRegreso)
          .catch(Util.muestraError);
      } catch (e) {
        Util.muestraError(e)
      }
    }
  </script>
</body>

</html>