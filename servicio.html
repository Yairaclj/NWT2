
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Usuario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#09CACD">

    <script src=
"https://unpkg.com/@webcomponents/webcomponentsjs@2.1.3/webcomponents-loader.js">
    </script>
    <script defer src="/__/firebase/5.5.4/firebase-app.js"></script>
    <script defer src="/__/firebase/5.5.4/firebase-auth.js"></script>
    <script defer src="/__/firebase/5.5.4/firebase-database.js"></script>
    <script defer src="/__/firebase/init.js"></script>
    <script type="module" src="js/herramientas-detalle.js"></script>
    <script type="module" src="js/campos-usuario.js"></script>
    <link rel="stylesheet" href="css/misestilos2.css">
    <link rel="shortcut icon" href="asd.ico" />
  </head>

  <body>

    <form class="vista let" name="vista" action="javascript:;">
      <herramientas-detalle id="cabecera" regreso="servicios.html"></herramientas-detalle>
      <main role="main" class="blanc">
              <h1>Modificar Servicio</h1>
        <p>
            <label>
              Categoria del Servicio
              <input type="text" name="cate" required="">
            </label>
          </p>
          <p>
            <label>
              Detalles del Servicio
              <input type="text" name="deta" required="">
            </label>
          </p>
          <p hidden>
            <label accesskey="c">
              Correo Electronico (ejp@gmail.com)
              <input name="cuenta" type="text" autofocus>
            </label>
          </p>
          <p hidden>
            <label>
              ID del Servicio
              <input type="text" name="id" required="">
            </label>
          </p>
          <p>

        </main>
      </form>
    <script type="module">
      import {Util} from "./js/util.js";
      import {Dao} from "./js/dao.js";
      import {Navegacion} from "./js/navegacion.js";
      Util.registraServiceWorker();
      const locationRegreso = "servicios.html";
      const parametros = new URLSearchParams(location.search);
      const id = parametros.get("id");
      let cuenta;
      document.addEventListener('DOMContentLoaded', () => {
        Navegacion.sesionInicia(["Administrador"]);
        if (WebComponents.ready) {
          carga();
        } else  {
          document.addEventListener('WebComponentsReady', carga);
        }
      });
      function carga() {
        Dao.busca("Servicio", id)
            .then(modelo => {
              if (modelo == null) {
                alert("Servicio no encontrado.");
                regresaAVistaMaestra();
              } else {
                document.vista.elimina
                    .addEventListener("click", confirmaEliminar);
                document.vista.addEventListener("submit", guarda);
                cuenta = Util.texto(modelo.cate);
                document.title = cuenta;
                document.vista.cuenta.value=modelo.cuenta;
                document.vista.cate.value=modelo.cate;
                document.vista.deta.value=modelo.deta;
                document.vista.id.value=modelo.id;
                document.vista.titulo.value = cuenta;
              }
            })
            .catch(Util.muestraError);
      }
      function guarda() {
        try {
          const cuenta = document.vista.cuenta.value.trim();
          const cate = document.vista.cate.value.trim();
          const deta = document.vista.deta.value.trim();
          const id = document.vista.id.value.trim();
          const modelo = {
            cuenta: cuenta,
            cate: cate,
            deta: deta,
            id: id,};
          Dao.modifica("Servicio", modelo)
              .then(regresaAVistaMaestra)
              .catch(Util.muestraError);
        } catch (e) {
          Util.muestraError(e)
        }
      }
      function confirmaEliminar() {
        if (confirm("Confirma la eliminación\nPerderás los datos.")) {
          Dao.elimina("Servicio", id)
              .then(regresaAVistaMaestra)
              .catch(Util.muestraError);
        }
      }
      function regresaAVistaMaestra() {
        window.location = locationRegreso;
      }
    </script>
  </body>
  <footer id="pie">
    Derechos Reservados &copy; NIGTHWOLF TEC 2018
  </footer>
</html>
